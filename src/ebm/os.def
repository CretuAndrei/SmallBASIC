define: EXE_HDR_SIZE=0x1000

emptyval: 0
romsize: auto
romsizealign: 4096

outfile:  ${APPNAME}.fxe
mapfile:  ${APPNAME}.mp
csumfile: ${APPNAME}.chk


align: bottom
load:  type=link32 ${APPNAME} base automin bump ${EXE_HDR_SIZE}

define: CODE_ROM_OFFSET=${EXE_HDR_SIZE}
define: DATA_ROM_OFFSET=${CODE_ROM_OFFSET}+${MAKEROM_codeseg_size_4k_aligned}

define: CSUM_START=${CODE_ROM_OFFSET}
define: CSUM_COUNT=${MAKEROM_codeseg_size_4k_aligned}+${MAKEROM_dataseg_size_4k_aligned}

set: offset=${CODE_ROM_OFFSET}+4
getU32: last_used_ebos_vector



#############################################################################
#
# Franklin EXE header
#
#############################################################################

set: offset=0
putstr: "FXE1"

# fx_version
putU8: value=0

# fx_premap: specify "ebos200" shared library
putU8: value=1

# fx_used_ebos_vectors
putU16: value=${last_used_ebos_vector}/8-0x2200


# fx_code_base_virt_addr
putU32: value=${MAKEROM_codeseg_base_4k_aligned}

# fx_code_size_bytes
putU32: value=${MAKEROM_codeseg_size_4k_aligned}

# fx_code_memobj_offset_bytes
putU32: value=${CODE_ROM_OFFSET}-${EXE_HDR_SIZE}

# fx_code_initial_pc
putU32: value=${MAKEROM_Code31_seg_base}

# fx_data_base_virt_addr
putU32: value=${MAKEROM_dataseg_base_4k_aligned}

# fx_data_size_bytes
putU32: value=${MAKEROM_dataseg_size_4k_aligned}

# fx_data_memobj_offset_bytes
putU32: value=${DATA_ROM_OFFSET}-${EXE_HDR_SIZE}

# fx_bss_base_virt_addr
putU32: value=${MAKEROM_ramseg_base_4k_aligned}

# fx_bss_size_bytes
putU32: value=${MAKEROM_ramseg_size_4k_aligned}

# fx_stack_size_bytes
putU32: value=${MAIN_STACK_SIZE}

# fx_pref_lcd_orientation (0=portrait)
putU16: value=0

# fx_pref_lcd_width
putU16: value=200

# fx_pref_lcd_height
putU16: value=240

# fx_pref_lcd_depth
putU16: value=4

# fx_min_lcd_width
putU16: value=200

# fx_min_lcd_height
putU16: value=240

# fx_min_lcd_depth
putU16: value=4

# fx_max_lcd_width
putU16: value=200

# fx_max_lcd_height
putU16: value=240

# fx_max_lcd_depth
putU16: value=4

# fx_build_date
putstr: ${DATE_STAMP}
putU8: value=0

# fx_build_time
putstr: ${TIME_STAMP}
putU8: value=0

# fx_build_csum
putsum: offset=${CSUM_START} count=${CSUM_COUNT} csumloc=${MAKEROM_cur_put_offset}

# Timer stack size
set:	offset = 4096
putU32:	value=${TIMER_STACK_SIZE}
